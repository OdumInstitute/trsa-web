<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      >

    <body>

        <ui:composition template="/template/layout.xhtml">

            <ui:define name="content">


                <style type="text/css">
                    .ui-row-editor .ui-row-editor-pencil {
                        margin-left:8px;
                    }
                </style>

                <h:form id="form" target="_blank">

                    <p:messages id="messages" showDetail="true" closable="true" 
                                for="topMessage" severity="info,warn,error,fatal">
                        <p:autoUpdate />
                    </p:messages>
                    <p:growl id="growl" showDetail="true" for="topGrowl"
                                     severity="info"/>
                    <h3 style="margin:5px 5px 30px 5px">Submission</h3>

<p:panel id="notaryServiceSelection" visible="#{! submissionPageView.publishButtonEnabled}">
                        
                    <h4 stype="margin:5px 5px 30px 5px"><h:outputText value="You may change the Notary Service Setting before submission."/></h4>
                    <br/>
                    <p:panelGrid id="nsPanel" columns="1"  >
                        <f:facet name="header">
                            Notary Service Designation
                        </f:facet>                    



                        <p:dataTable id="nsSelect" 
                                     editable="true" 
                                     editMode="row"
                                     var="dataFile"
                                     value="#{submissionPageView.ingestedDataFileList}" 
                                     cellEditMode="eager" 
                                     style="margin-bottom:20px">
                            <f:facet name="header">
                                Set Notary Service Bound or not for Each Ingested File
                            </f:facet>

                            <p:ajax event="rowEdit" 
                                    listener="#{submissionPageView.onRowEdit}" 
                                    update=":form:messages" />
                            <p:ajax event="rowEditCancel" 
                                    listener="#{submissionPageView.onRowCancel}" 
                                    update=":form:messages" />

                            <p:column headerText="DataFile Id">
                                <h:outputText value="#{dataFile.id}" />
                            </p:column>
                            
                            <p:column headerText="DataFile Label">
                                <h:outputText value="#{dataFile.fileMetadata.label}" />
                            </p:column>

                            <p:column headerText="Notary-Service">
                                <p:cellEditor>
                                    <f:facet name="output">
                                        <p:selectBooleanButton 
                                            onLabel="Yes" 
                                            offLabel="No" 
                                            value="#{dataFile.notaryServiceBound}" 
                                            onIcon="ui-icon-check" 
                                            offIcon="ui-icon-close" />
                                    </f:facet>
                                    <f:facet name="input" id="nsvalue">
                                        <p:selectBooleanButton 
                                            onLabel="Yes" 
                                            offLabel="No" 
                                            value="#{dataFile.notaryServiceBound}" 
                                            onIcon="ui-icon-check" 
                                            offIcon="ui-icon-close" />
                                    </f:facet>
                                </p:cellEditor>

                            </p:column>
                            <p:column style="width:35px" headerText="Modify">
                                <p:rowEditor 
                                    editTitle="Change default designation" 
                                    saveTitle="Save change" 
                                    cancelTitle='Cancel' 
                                    />
                            </p:column>
                        <f:facet name="footer">
                            <p:commandButton id="saveNSBoundupdate" 
                                             ajax="true" 
                                             update="form:messages form:growl, form:summaryPanel form:submitButton saveNSBoundupdate form:notaryServiceSelection showNsExceptionMessage" 
                                             value="save Notary Service designation" 
                                             action="#{submissionPageView.saveNSchanges}"
                                             disabled="#{! submissionPageView.designationButtonEnable}"
                                             style="font-size: 120%"/>
                            
                            <p:commandButton id="showNsExceptionMessage"
                                             value="Show Error Message"
                                             icon="pi pi-external-link" 
                                             disabled="#{!submissionPageView.showNsExceptionMsgEnabled}"
                                             action="#{submissionPageView.showExceptionMessage}"/>
                            
                        </f:facet>
                        </p:dataTable>



                        
                    </p:panelGrid>
</p:panel>


<p:panel id="summaryPanel" visible="#{submissionPageView.publishButtonEnabled}">
                    <p:panelGrid columns="2"  
                                 >            
                        <f:facet name="header">
                            Submission: Detail
                        </f:facet>
                        <h:outputLabel for="dataverseServer"  value="Dataverse server:" /> 
                        <h:outputText id="dataverseServer" value="#{submissionPageView.dataverseServer}" />
                        <h:outputLabel for="apiKey" value="api key:" />
                        <h:outputText id="apiKey" value="#{submissionPageView.apiKey}" />
                        <h:outputLabel for="targetDatasetId" value="Dataset Id:" /> 
                        <h:outputText id="targetDatasetId" value="#{submissionPageView.selectedDatasetId}" /> 
                        <h:outputLabel for="DatasetDoi" value="Dataset DOI:" />
                        <h:outputText id="DatasetDoi" value="#{submissionPageView.datasetDoi}" /> 
                        <h:outputLabel for="zipfileName" value="Ingested file:" /> 
                        <h:outputText id="zipfileName" value="#{submissionPageView.filenameonly}" />
                        <h:outputLabel for="trsaRegNmbr" value="TRSA Registration Number:" /> 
                        <h:outputText id="trsaRegNmbr" value="#{submissionPageView.trsaRegNmbr}" /> 
                        <f:facet name="footer">

                            <p:commandButton id="submitButton" 
                                             ajax="true" 
                                             update="messages submitButton showSubmitExceptionMessage" 
                                             value="Submit Metadata" 
                                             disabled="#{!submissionPageView.publishButtonEnabled}"
                                             actionListener="#{submissionPageView.submissionFacade()}" />

                            
                            <p:commandButton id="showSubmitExceptionMessage"
                                             value="Show Error Message"
                                             icon="pi pi-external-link" 
                                             disabled="#{!submissionPageView.showNsExceptionMsgEnabled}"
                                             action="#{submissionPageView.showExceptionMessage}"/>
                            
                            
                            <p:commandButton id="returnToMainMenuButton"
                                             ajax="true" update="messages" 
                                             value="return to the Main Menu" 
                                             action="#{submissionPageView.returnToMainMenu}"
                                             />
                        </f:facet>
                    </p:panelGrid>
</p:panel>
                </h:form>

            </ui:define>

        </ui:composition>

    </body>
</html>
